From: =?utf-8?q?Martin_Stegh=C3=B6fer?= <martin@steghoefer.eu>
Date: Sat, 10 May 2014 13:19:25 +0200
Subject: Fix FP exception: Sample aspect ratio (Libav/FFmpeg)
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: 8bit

Author: Martin Stegh√∂fer <martin@steghoefer.eu>
Forwarded: not-needed

The upstream developers compile Karlyriceditor against FFmpeg, but in Debian
there is only Libav available, whose API is slowly drifting away from
FFmpeg's. This patch adapts the code to one of those differences.
In Libav sample aspect ratio of a AVStream object is not automatically
initialized to the one of its codec. So this has to be done manually.
---
 src/ffmpegvideoencoder.cpp | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/ffmpegvideoencoder.cpp b/src/ffmpegvideoencoder.cpp
index ccfdc7c..3122f2a 100644
--- a/src/ffmpegvideoencoder.cpp
+++ b/src/ffmpegvideoencoder.cpp
@@ -399,6 +399,7 @@ av_log_set_level(AV_LOG_VERBOSE);
 	videoStream->codec = videoCodecCtx;
 
 	// Set the video stream timebase if not set
+	videoStream->sample_aspect_ratio = videoCodecCtx->sample_aspect_ratio;
 	if ( videoStream->time_base.den == 0 )
 		videoStream->time_base = videoCodecCtx->time_base;
 
